% defining the new dimensions
\newlength{\starsize}
\newlength{\starspread}
% declaring the keys in tikz
\tikzset{starsize/.code={\setlength{\starsize}{#1}},
         starspread/.code={\setlength{\starspread}{#1}}}
% setting the default values
\tikzset{starsize=1mm,
         starspread=3mm}
% declaring the pattern
\pgfdeclarepatternformonly[\starspread,\starsize]% variables
  {custom fivepointed stars}% name
  {\pgfpointorigin}% lower left corner
  {\pgfqpoint{\starspread}{\starspread}}% upper right corner
  {\pgfqpoint{\starspread}{\starspread}}% tilesize
  {% shape description
   \pgftransformshift{\pgfqpoint{\starsize}{\starsize}}
   \pgfpathmoveto{\pgfqpointpolar{18}{\starsize}}
   \pgfpathlineto{\pgfqpointpolar{162}{\starsize}}
   \pgfpathlineto{\pgfqpointpolar{306}{\starsize}}
   \pgfpathlineto{\pgfqpointpolar{90}{\starsize}}
   \pgfpathlineto{\pgfqpointpolar{234}{\starsize}}
   \pgfpathclose%
   \pgfusepath{fill}
  }



\begin{tikzpicture}[scale=0.22,>=latex']
%\begin{tikzpicture}[scale=0.17,>=latex']
    % teh boxez
    \draw[thick] (0,0) -- (20,0) -- (20,-34);
    \draw[thick,dashed] (20,-34) -- (15,-33) -- (10,-34) -- (5,-33) -- (0,-34);
    \draw[thick] (0,-34) -- (0,0);
    \draw[thick] (25,-4) -- (45,-4) -- (45,-34);
    \draw[thick,dashed] (45,-34) -- (40,-33) -- (35,-34) -- (30,-33) -- (25,-34);
    \draw[thick] (25,-34) -- (25,-4);
    % teh row indices for the state
    \node at (-2,0) {-4};
    \node at (-2,-4) {0};
    \node at (-2,-20) {16};
    \node at (-2,-26) {22};
    \node at (-2,-34) {30};
    % teh row indices for the message
    \node at (23,-4) {0};
    \node at (23,-19) {15};
    % the fillings
    \draw[pattern=crosshatch] (0,0) rectangle (20,-4); % IV
    \fill[pattern=north west lines] (0,-4) rectangle (20,-18); % base solution
    \fill[pattern=north west lines] (0,-18) -- (7,-18) -- (0,-22); % base solution
    \fill[pattern=north west lines] (13,-18) -- (20,-18) -- (20,-22); % base solution
	\draw (0,-22) -- (7,-18) -- (13,-18) -- (20,-22);
    \fill[pattern=custom fivepointed stars,starspread=1.4mm,starsize=0.5mm] (0,-22.2) -- (7,-18) -- (13,-18) -- (20,-22.2); % NB 1
	\fill[pattern=custom fivepointed stars,starspread=1.7mm,starsize=0.5mm] (0,-22.4) rectangle (20,-26); % NB 2
    \fill[pattern=custom fivepointed stars,starspread=2.1mm,starsize=0.5mm] (0,-26.1) rectangle (20,-30); % NB 3
    \fill[pattern=custom fivepointed stars,starspread=2.5mm,starsize=0.5mm] (0,-30) rectangle (20,-33); % NB 6
	\fill[pattern=north east lines] (25,-4) rectangle (45,-15); % message
	\fill[pattern=north east lines] (25,-15) --  (32,-15) -- (29,-19) -- (25,-19) ; % message
	\fill[pattern=north east lines] (38,-15) --  (45,-15) -- (45,-19) -- (41,-19) ; % message
	\draw (25,-19) -- (29,-19) --  (32,-15) -- (38,-15) -- (41,-19) -- (45,-19);
	\draw (25,-19) -- (41,-19);
	\fill[pattern=vertical lines] (32,-15) -- (38,-15) -- (41,-19);
	\fill[pattern=horizontal lines] (29,-19) -- (32,-15) -- (41,-19);

    % legends
    \draw[thick] (50,-8) rectangle (51.5,-9.5);
    \node[anchor=text] at (55,-9.5) {$\iv$};
    \draw[pattern=crosshatch] (50,-8) rectangle (51.5,-9.5);
    %
    \draw[thick] (50,-12) rectangle (51.5,-13.5);
    \node[anchor=text] at (55,-13.5) {Deterministic};
    \node[anchor=text] at (55,-15) {conditions};
    \draw[pattern=north west lines] (50,-12) rectangle (51.5,-13.5);
    %
    \draw[thick] (50,-16) rectangle (51.5,-17.5);
    \node[anchor=text] at (55,-17.5) {Probabilistic};
    \node[anchor=text] at (55,-19) {conditions};
    \draw[pattern=custom fivepointed stars,starspread=1.2mm,starsize=0.5mm] (50,-16) rectangle (51.5,-17.5);
    %
    \draw[thick] (50,-20) rectangle (51.5,-21.5);
    \node[anchor=text] at (55,-21.5) {Fixed};
    \node[anchor=text] at (55,-23) {message};
    \draw[pattern=north east lines] (50,-20) rectangle (51.5,-21.5);
    %
    \draw[thick] (50,-24) rectangle (51.5,-25.5);
    \node[anchor=text] at (55,-25.5) {Randomized};
    \node[anchor=text] at (55,-27) {message};
    \draw[pattern=horizontal lines] (50,-24) rectangle (51.5,-25.5);
    %
    \draw[thick] (50,-28) rectangle (51.5,-29.5);
    \node[anchor=text] at (55,-29.5) {Neutral bits};
    \draw[pattern=vertical lines] (50,-28) rectangle (51.5,-29.5);

    %title
    \node[anchor=text] at (0,3) {\shazero State words ($\state_i$)};
    \node[anchor=text] at (25,3) {\shazero Message words ($\expmess_i$)};

\end{tikzpicture}
